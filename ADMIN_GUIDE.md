# Руководство администратора - Модульная игра в слова

## Обзор системы

Это модульная веб-игра в слова с поддержкой множественных языков и раскладок клавиатуры. Игра построена на архитектуре модулей ES6 и поддерживает динамическое управление контентом.

## Архитектура системы

### Основные модули

#### 1. **DataManager.js** - Управление данными
- **Назначение**: Централизованное управление загрузкой и кэшированием данных
- **Функции**:
  - `loadCategories()` - Загрузка списка категорий из JSON
  - `loadWords(category, language)` - Загрузка слов для конкретной категории и языка
  - `loadImages(category)` - Загрузка изображений для категории
  - `validateData(category, language)` - Проверка соответствия слов и изображений
- **Кэширование**: Использует Map для кэширования загруженных данных
- **Обработка ошибок**: Логирование и graceful fallback при ошибках загрузки

#### 2. **LanguageManager.js** - Управление языками и локализацией
- **Назначение**: Полное управление многоязычностью и раскладками клавиатуры
- **Основные функции**:
  - `initialize()` - Инициализация из конфигурационного файла
  - `setLanguage(code)` - Переключение языка интерфейса
  - `setKeyboardLayout(code)` - Переключение раскладки клавиатуры
  - `createMobileKeyboard()` - Генерация виртуальной клавиатуры
  - `localizeDOM()` - Автоматическая локализация элементов с data-i18n
- **Поддерживаемые языки**: Русский, Английский, Испанский
- **Поддерживаемые раскладки**: QWERTY, Dvorak, Colemak для каждого языка
- **Мобильная оптимизация**: Адаптивная виртуальная клавиатура

#### 3. **CategoryManager.js** - Управление категориями
- **Назначение**: Управление игровыми категориями и их валидация
- **Функции**:
  - `loadCategories()` - Загрузка доступных категорий
  - `addCategory()` - Добавление новых категорий
  - `validateCategory()` - Проверка целостности данных категории
  - `createCategorySelector()` - Создание UI для выбора категорий

#### 4. **GameEngine.js** - Игровая логика
- **Назначение**: Основная логика игрового процесса
- **Состояния игры**: STOPPED, RUNNING, PAUSED
- **Функции**:
  - `startGame()` - Запуск новой игры
  - `pauseGame()` / `resumeGame()` - Управление паузой
  - `processInput()` - Обработка пользовательского ввода
  - `checkAnswer()` - Проверка правильности ответа
  - `nextWord()` - Переход к следующему слову
  - `updateScore()` - Обновление счета и статистики

### Структура файлов

```
WordGameModul/
├── index.html              # Главная страница
├── styles.css              # Основные стили
├── modules/                # ES6 модули
│   ├── DataManager.js      # Управление данными
│   ├── LanguageManager.js  # Языки и локализация
│   ├── CategoryManager.js  # Управление категориями
│   └── GameEngine.js       # Игровая логика
├── data/                   # Данные игры
│   ├── config/            # Конфигурационные файлы
│   │   ├── languages.json # Языки и раскладки
│   │   └── categories.json # Список категорий
│   ├── words/             # Текстовые файлы со словами
│   │   ├── ru/           # Русские слова
│   │   ├── en/           # Английские слова
│   │   └── es/           # Испанские слова
│   └── images/           # Изображения для категорий
└── ADMIN_GUIDE.md        # Это руководство
```

## Конфигурация системы

### 1. Языки и раскладки (data/config/languages.json)

```json
{
  "ru": {
    "name": "Русский",
    "keyboards": {
      "qwerty": {
        "name": "QWERTY",
        "layout": ["Й","Ц","У",...] // 33 буквы + дефис + пробел
      },
      "dvorak": {
        "name": "Dvorak (RU)",
        "layout": ["Я","Ч","Е",...] // Оптимизированная раскладка
      },
      "colemak": {
        "name": "Colemak (RU)",
        "layout": ["Й","В","Ф",...] // Эргономичная раскладка
      }
    },
    "ui": {
      "score": "Очки",
      "start": "Старт",
      // ... все UI тексты
    }
  }
}
```

**Особенности раскладок:**
- **QWERTY**: Стандартная русская раскладка (12+11+9+2)
- **Dvorak**: Оптимизированная для частоты букв (10+11+11+3)
- **Colemak**: Эргономичная раскладка (10+10+12+2)

### 2. Категории (data/config/categories.json)

```json
{
  "categories": [
    {
      "id": "animals",
      "name": {
        "ru": "Животные",
        "en": "Animals",
        "es": "Animales"
      },
      "description": {
        "ru": "Различные виды животных",
        "en": "Various animal species",
        "es": "Varias especies de animales"
      }
    }
  ]
}
```

## Игровая механика

### Процесс игры

1. **Инициализация**:
   - Загрузка конфигурации языков
   - Создание UI селекторов
   - Инициализация виртуальной клавиатуры

2. **Выбор параметров**:
   - Язык интерфейса и игры
   - Раскладка клавиатуры
   - Категория слов

3. **Игровой цикл**:
   - Показ изображения
   - Ввод пользователя (физическая или виртуальная клавиатура)
   - Проверка ответа
   - Обновление счета
   - Переход к следующему слову

4. **Завершение**:
   - Подсчет финального счета
   - Сохранение статистики

### Система счета

- **Правильный ответ**: +10 очков
- **Неправильный ответ**: -5 очков
- **Бонус за скорость**: +1-5 очков (зависит от времени)
- **Штраф за подсказки**: -2 очка за каждую подсказку

## Виртуальная клавиатура

### Адаптивная система

Клавиатура автоматически адаптируется под:
- **Язык**: Показывает только релевантные буквы
- **Раскладку**: QWERTY, Dvorak, или Colemak
- **Устройство**: Оптимизация для мобильных экранов

### Мобильная оптимизация

```css
.keyboard-row {
    display: flex;
    justify-content: center;
    gap: 2px; /* Минимальные отступы для мобильных */
    margin-bottom: 3px;
}

.key {
    min-width: 25px; /* Компактные кнопки */
    height: 35px;
    font-size: 14px;
}
```

## Управление данными

### Структура файлов слов

Файлы со словами должны содержать по одному слову на строку:
```
КОШКА
СОБАКА
МЕДВЕДЬ
```

### Структура изображений

Изображения должны называться точно как слова:
```
data/images/animals/
├── КОШКА.jpg
├── СОБАКА.png
└── МЕДВЕДЬ.gif
```

### Валидация данных

Система автоматически проверяет:
- Соответствие слов и изображений
- Корректность символов для выбранного языка
- Наличие всех необходимых файлов

## API модулей

### DataManager

```javascript
// Загрузка категорий
const categories = await dataManager.loadCategories();

// Загрузка слов для категории
const words = await dataManager.loadWords('animals', 'ru');

// Валидация данных
const validation = await dataManager.validateData('animals', 'ru');
```

### LanguageManager

```javascript
// Инициализация
await languageManager.initialize();

// Смена языка
languageManager.setLanguage('ru');

// Смена раскладки
languageManager.setKeyboardLayout('dvorak');

// Создание клавиатуры
languageManager.createMobileKeyboard('keyboard-container', onKeyPress);
```

### GameEngine

```javascript
// Запуск игры
gameEngine.startGame('animals', 'ru');

// Обработка ввода
gameEngine.processInput('К');

// Проверка ответа
const isCorrect = gameEngine.checkAnswer();
```

## Расширение системы

### Добавление нового языка

1. **Обновить languages.json**:
```json
"de": {
  "name": "Deutsch",
  "keyboards": {
    "qwerty": {
      "name": "QWERTZ",
      "layout": ["Q","W","E","R","T","Z",...]
    }
  },
  "ui": {
    "score": "Punkte",
    "start": "Start"
  }
}
```

2. **Создать папку для слов**: `data/words/de/`

3. **Обновить CategoryManager** для поддержки нового языка

### Добавление новой раскладки

1. **Добавить в languages.json**:
```json
"workman": {
  "name": "Workman",
  "layout": ["Q","D","R","W","B",...]
}
```

2. **Обновить getKeyboardRows()** в LanguageManager для правильного разбиения

### Добавление новой категории

1. **Обновить categories.json**
2. **Создать файлы слов** для всех поддерживаемых языков
3. **Добавить изображения** в соответствующую папку

## Отладка и мониторинг

### Логирование

Все модули используют console.log для отладки:
- Загрузка данных
- Смена языка/раскладки
- Игровые события
- Ошибки валидации

### Проверка состояния

```javascript
// Проверка текущего состояния
console.log('Язык:', languageManager.getCurrentLanguage());
console.log('Раскладка:', languageManager.getCurrentKeyboardLayout());
console.log('Состояние игры:', gameEngine.getGameState());
```

## Производительность

### Кэширование

- **DataManager**: Кэширует загруженные слова и изображения
- **LanguageManager**: Кэширует конфигурацию языков
- **Браузер**: Использует HTTP кэширование для статических ресурсов

### Оптимизация

- Ленивая загрузка изображений
- Минификация CSS/JS в продакшене
- Сжатие изображений
- Использование WebP формата где возможно

## Безопасность

### Валидация ввода

- Проверка символов на соответствие выбранному языку
- Санитизация пользовательского ввода
- Ограничение длины ввода

### Защита от XSS

- Использование textContent вместо innerHTML
- Валидация всех пользовательских данных
- Экранирование специальных символов

## Развертывание

### Локальная разработка

```bash
# Запуск локального сервера
python -m http.server 8000

# Или с Node.js
npx http-server -p 8000
```

### Продакшн

1. **Минификация**: Сжатие CSS и JS файлов
2. **Оптимизация изображений**: Конвертация в WebP
3. **Кэширование**: Настройка HTTP заголовков
4. **CDN**: Использование для статических ресурсов

## Поддержка и обслуживание

### Регулярные задачи

- Обновление словарей
- Добавление новых изображений
- Проверка работоспособности на новых устройствах
- Обновление переводов

### Мониторинг

- Отслеживание ошибок JavaScript
- Мониторинг времени загрузки
- Анализ использования различных языков/раскладок

---

*Это руководство покрывает все аспекты системы. При возникновении вопросов обращайтесь к комментариям в коде или создавайте issue в системе управления проектом.* 